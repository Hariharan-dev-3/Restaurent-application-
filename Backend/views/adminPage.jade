extends ./layout.jade

block content
  include ./includes/navbar.jade

  section.tableContainer
    table
      thead
        tr
          th UserName
          th Email
          th Password
          th Action
      tbody
        each user in users
          tr
            td= user.userName
            td= user.userEmail
            td= user.userPassword.slice(0,5) + '...'
            td 
              button(onclick=`deleteUser("${user.userId}")`) Delete
              button(onclick=`showPopup("${user.userId}", "${user.userName}")`) Update

  div#popupContainer(style="display: none")
    h3 Update User

    label(for="userIdInput") User ID:
    input#userIdInput(type="text", readonly=true)

    label(for="userNameInput") User Name:
    input#userNameInput(type="text")

    button(onclick="submitCredentials()") Submit
    button(onclick="hidePopup()") Cancel

  script.
    function deleteUser(id) {
      if (confirm("Are you sure you want to delete this user?")) {
        fetch('/api/v1/user/deleteUser/' + id, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          location.reload();
        })
        .catch(err => {
          console.error("Delete failed:", err);
          alert("Something went wrong.");
        });
      }
    }

    function showPopup(id, name) {
      document.getElementById("popupContainer").style.display = "block";
      document.getElementById("userIdInput").value = id;
      document.getElementById("userNameInput").value = name;
    }

    function hidePopup() {
      document.getElementById("popupContainer").style.display = "none";
    }

    function submitCredentials() {
      const id = document.getElementById("userIdInput").value;
      const userName = document.getElementById("userNameInput").value;

      fetch(`/api/v1/user/updateUser/${id}/${userName}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        hidePopup();
        location.reload();
      })
      .catch(err => {
        console.error("Submission failed:", err);
        alert("Something went wrong.");
      });
    }